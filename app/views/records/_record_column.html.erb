<%= column_fields.hidden_field :id %>

<div class="bg-white shadow-md rounded-lg overflow-hidden">
  <div class="p-4 space-y-4">
    <!-- Column header with collapse and delete icons -->
    <div class="flex justify-between items-center">
      <div class="flex items-center space-x-2">
        <input type="checkbox" id="user-checkbox1" checked class="form-checkbox text-indigo-600 h-5 w-5"/>
        <label for="user-checkbox1"></label>
        <div>
          <h5 class="text-lg font-semibold text-gray-800"><%= @subrecords.present? ? 'Sub Records' : 'Repetitive Records' %></h5>
        </div>
      </div>
      <div class="flex space-x-2">
        <button type="button" class="p-1 rounded-full text-gray-400 hover:text-gray-600 focus:outline-none">
          <i class="fas fa-chevron-up"></i>
        </button>
        <button type="button" class="p-1 rounded-full text-gray-400 hover:text-gray-600 focus:outline-none">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <!-- Radio Button Group for filter solved status -->
    <div class="flex items-center space-x-4">
      <%= column_fields.radio_button :filter_solved_status, 'any', class: "form-radio text-indigo-600 h-5 w-5" %>
      <%= column_fields.label :filter_solved_status, 'Any', value: 'any', class: 'text-gray-700' %>
      <%= column_fields.radio_button :filter_solved_status, 'solved', class: "form-radio text-indigo-600 h-5 w-5" %>
      <%= column_fields.label :filter_solved_status, 'Only Solved', value: 'solved', class: 'text-gray-700' %>
      <%= column_fields.radio_button :filter_solved_status, 'unsolved', class: "form-radio text-indigo-600 h-5 w-5" %>
      <%= column_fields.label :filter_solved_status, 'Only Unsolved', value: 'unsolved', class: 'text-gray-700' %>
    </div>
    <!-- Record Type Selector -->
    <div>
      <%= label_tag 'record_type_id', 'Record Type', class: 'block text-sm font-medium text-gray-700' %>
      <div class="relative">
        <%= column_fields.select :record_type_id, options_from_collection_for_select(@record_types, :id, :name, column_fields.object.record_type_id), { include_blank: true }, { class: "block appearance-none w-full bg-gray-100 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm" } %>
      </div>
    </div>

    <!-- View Options for collapsed state -->
    <div class="flex items-center space-x-4">
      <%= column_fields.radio_button :collapsed, 'true', class: "form-radio text-indigo-600 h-5 w-5" %>
      <%= column_fields.label :collapsed, 'Collapsed View', value: 'true', class: 'text-gray-700' %>
      <%= column_fields.radio_button :collapsed, 'false', class: "form-radio text-indigo-600 h-5 w-5" %>
      <%= column_fields.label :collapsed, 'Full View', value: 'false', class: 'text-gray-700' %>
    </div>

    <!-- Update Column Filters Button -->
    <div class="text-right">
      <%= desire_form.submit 'Update Column Filters', class: 'inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500' %>
    </div>

    <!-- Display records; this will call partials for each record based on the collapsed state -->
    <div>
      <%= design_fields.fields_for :group do |group_fields| %>
        <%= group_fields.collection_check_boxes(:record_a_ids, records_for_column(@records, @record_types, column_fields.object, @subrecords ? @record : nil), :id, :name) do |group_item| %>
          <% if column_fields.object.collapsed %>
            <%= render 'records/collapsed_record', record: group_item.object, group_item: group_item %>
          <% else %>
            <%= render "records/semi_collapsed_record", record: group_item.object, group_item: group_item %>
          <% end %>
        <% end %>
      <% end %>
    </div>

    <!-- Pagination if necessary -->
    <div class="mt-4">
      <%= paginate records_for_column(@records, @record_types, column_fields.object, @subrecords ? @record : nil), param_name: "desire[design_attributes][columns_attributes][#{column_fields.options[:child_index]}][page]" %>
    </div>
  </div>
</div>
